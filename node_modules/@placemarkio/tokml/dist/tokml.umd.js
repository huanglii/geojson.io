!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).toGeoJSON={})}(this,(function(t){"use strict";var e=function(t,e,n){var r={type:String(t)};return null!=n||"string"!=typeof e&&!Array.isArray(e)?Object.assign(r,e):n=e,Array.isArray(n)?r.children=n:null!=n&&(r.value=String(n)),r};const n=function(t,e,...n){var o,i,u=-1;if(null==t)o={type:"root",children:[]},n.unshift(e);else{if("string"!=typeof t)throw new TypeError("Expected element name, got `"+t+"`");if(o={type:"element",name:t,attributes:{},children:[]},function(t){if(null==t||"object"!=typeof t||Array.isArray(t))return!1;return!0}(e))for(i in e)void 0===e[i]||null===e[i]||"number"==typeof e[i]&&Number.isNaN(e[i])||(o.attributes[i]=String(e[i]));else n.unshift(e)}for(;++u<n.length;)r(o.children,n[u]);return o};function r(t,e){var n=-1;if(null==e);else if("string"==typeof e||"number"==typeof e)t.push({type:"text",value:String(e)});else if(Array.isArray(e))for(;++n<e.length;)r(t,e[n]);else{if("object"!=typeof e||!("type"in e))throw new TypeError("Expected node, nodes, string, got `"+e+"`");"root"===e.type?r(t,e.children):t.push(e)}}function o(t,e){for(var n=t&&t.children||[],r=-1,o=[];++r<n.length;)o[r]=S(n[r],e);return o.join("")}function i(t,e){return t=t.replace(e.subset?function(t){const e=[];let n=-1;for(;++n<t.length;)e.push(t[n].replace(/[|\\{}()[\]^$+*?.]/g,"\\$&"));return new RegExp("(?:"+e.join("|")+")","g")}(e.subset):/["&'<>`]/g,n),e.subset||e.escapeOnly?t:t.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,(function(t,n,r){return e.format(1024*(t.charCodeAt(0)-55296)+t.charCodeAt(1)-56320+65536,r.charCodeAt(n+2),e)})).replace(/[\x01-\t\v\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,n);function n(t,n,r){return e.format(t.charCodeAt(0),r.charCodeAt(n+1),e)}}function u(t){return"&#x"+t.toString(16).toUpperCase()+";"}var a=/[\u0000-\u0008\u000B\u000C\u000E-\u001F]/g;function c(t,e,n){var r=function(t){return String(t||"").replace(a,"")}(t);return n?r.replace(n,o):o(r);function o(t){return function(t,e){return i(t,Object.assign({format:u},e))}(t,{subset:e})}}var l=["\t","\n"," ",'"',"&","'","/","<","=",">"];function s(t){return c(t,l)}function f(t,e){const n=String(t);if("string"!=typeof e)throw new TypeError("Expected character");let r=0,o=n.indexOf(e);for(;-1!==o;)r++,o=n.indexOf(e,o+e.length);return r}function p(t,e){var n=e.quote,r=e.alternative,o=String(t),i=r&&f(o,n)>f(o,r)?r:n;return i+c(o,["<","&",i])+i}var d={}.hasOwnProperty;var y=["&","<"];function g(t){return c(t.value,y)}var m=/\?>/g,h=[">"];var v=/]]>/g,x=[">"];var b={}.hasOwnProperty,w={root:o,element:function(t,e){var n,r,i=s(t.name),u=o(t,e),a=t.attributes||{},c=!u&&e.close,l=[];for(n in a)d.call(a,n)&&null!=(r=a[n])&&l.push(s(n)+"="+p(r,e));return"<"+i+(0===l.length?"":" "+l.join(" "))+(c?(e.tight?"":" ")+"/":"")+">"+u+(c?"":"</"+i+">")},text:g,comment:function(t){return"\x3c!--"+c(t.value,["-"])+"--\x3e"},doctype:function(t,e){var n=s(t.name),r=t.public,o=t.system,i="<!DOCTYPE";return""!==n&&(i+=" "+n),null!=r&&""!==r?i+=" PUBLIC "+p(r,e):null!=o&&""!==o&&(i+=" SYSTEM"),null!=o&&""!==o&&(i+=" "+p(o,e)),i+">"},instruction:function(t){var e=s(t.name)||"x",n=c(t.value,h,m);return"<?"+e+(n?" "+n:"")+"?>"},cdata:function(t){return"<![CDATA["+c(t.value,x,v)+"]]>"},raw:function(t,e){return e.dangerous?t.value:g(t)}};function S(t,e){var n=t&&t.type;if(!n)throw new Error("Expected node, not `"+t+"`");if(!b.call(w,n))throw new Error("Cannot compile unknown node `"+n+"`");return w[n](t,e)}function M(t,e={}){var n=e.quote||'"',r='"'===n?"'":'"',o=e.quoteSmart,i=Array.isArray(t)?{type:"root",children:t}:t;if('"'!==n&&"'"!==n)throw new Error("Invalid quote `"+n+"`, expected `'` or `\"`");return S(i,{dangerous:e.allowDangerousXml,close:e.closeEmptyElements,tight:e.tightClose,quote:n,alternative:o?r:null})}const A=e("text","\n"),E=e("text","  ");function F(t){switch(t.type){case"Feature":return j(t);case"folder":return function(t){const e=["string","number"].includes(typeof t.meta.id)?{id:String(t.meta.id)}:{};return[A,n("Folder",e,[A,...P(t.meta),A,E,...t.children.flatMap((t=>F(t)))])]}(t)}}const C=["address","description","name","open","visibility","phoneNumber"];function P(t){return C.filter((e=>void 0!==t[e])).map((r=>n(r,[e("text",String(t[r]))])))}function j(t){const{id:e}=t,r=["string","number"].includes(typeof e)?{id:e}:{};return[A,n("Placemark",r,[A,...N(t.properties),A,E,...t.geometry?[B(t.geometry)]:[]])]}function D(t){return`${t[0]},${t[1]}`}function O(t){return n("coordinates",[e("text",t.map(D).join("\n"))])}function T(t){switch(typeof t){case"string":return t;case"boolean":case"number":return String(t);case"object":try{return JSON.stringify(t)}catch(t){return""}}return""}function L(t){return t&&"object"==typeof t&&"@type"in t&&"html"===t["@type"]&&"value"in t&&"string"==typeof t.value?e("cdata",t.value):T(t)}function N(t){if(!t)return[];const{name:r,description:o,visibility:i,...u}=t;return[r&&n("name",[e("text",T(r))]),o&&n("description",[e("text",L(o))]),void 0!==i&&n("visibility",[e("text",i?"1":"0")]),n("ExtendedData",Object.entries(u).flatMap((([t,r])=>[A,E,n("Data",{name:t},[n("value",[e("text","string"==typeof r?r:JSON.stringify(r))])])])))].filter(Boolean)}const k=t=>n("LinearRing",[O(t)]);function B(t){switch(t.type){case"Point":return n("Point",[(r=t.coordinates,n("coordinates",[e("text",D(r))]))]);case"MultiPoint":return function(t){return n("MultiGeometry",t.coordinates.flatMap((t=>[A,B({type:"Point",coordinates:t})])))}(t);case"LineString":return n("LineString",[O(t.coordinates)]);case"MultiLineString":return function(t){return n("MultiGeometry",t.coordinates.flatMap((t=>[A,B({type:"LineString",coordinates:t})])))}(t);case"Polygon":return function(t){const[e,...r]=t.coordinates;return n("Polygon",[A,n("outerBoundaryIs",[A,E,k(e)]),...r.flatMap((t=>[A,n("innerBoundaryIs",[A,E,k(t)])]))])}(t);case"MultiPolygon":return function(t){return n("MultiGeometry",t.coordinates.flatMap((t=>[A,B({type:"Polygon",coordinates:t})])))}(t);case"GeometryCollection":return n("MultiGeometry",t.geometries.flatMap((t=>[A,B(t)])))}var r}t.foldersToKML=function(t){return M(e("root",[n("kml",{xmlns:"http://www.opengis.net/kml/2.2"},n("Document",t.children.flatMap((t=>F(t)))))]))},t.toKML=function(t){return M(e("root",[n("kml",{xmlns:"http://www.opengis.net/kml/2.2"},n("Document",t.features.flatMap((t=>j(t)))))]))},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=tokml.umd.js.map
